- hosts: ome
  name: Dell OpenManage Ansible Alert policies.
  gather_facts: false

  tasks:
    - name: "Create a Alert Policy"
      dellemc.openamanage.ome_alert_policies:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        name: "Alert Policy One"
        device_service_tag:
          - ABCD123
          - SVC7845
        category:
          - catalog_name: Application
            catalog_category:
              - category_name: Audit
                sub_category_names:
                  - idrac
                  - Generic
                  - Device
              - category_name: Storage
                sub_category_names:
                  - Other
        date_and_time:
          date_from: 2023-10-10
          date_to: 2023-10-11
          time_from: "11:00"
          time_to: "12:00"
          time_interval: true
        severity:
          - unknown
          - critical
        actions:
          - action_name: trap
            parameters:
              - name: "192.1.2.3:162"
                value: true
              - name: "traphostname.domain.com:162"
                value: true
      tags: create_alert_policy
      delegate_to: localhost      

    - name: "Update a Alert Policies"
      dellemc.openamanage.ome_alert_policies:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        new_name: "Update Policy Name"
        device_group: "Group Name"
        message_ids:
          - AMP400
          - CTL201
          - BIOS123
        date_and_time:
          date_from: 2023-10-10
          date_to: 2023-10-11
          time_from: "11:00"
          time_to: "12:00"
          time_interval: true
        actions:
          - action_name: Trap
            parameters:
              - name: "192.1.2.3:162"
                value: true
      tags: update_alert_policy
      delegate_to: localhost

    - name: "Enable a Policy"
      dellemc.openamanage.ome_alert_policies:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        new_name: "Policy Name"
        device_group: "Group Name"
        enable: True
      tags: enable_alert_policy
      delegate_to: localhost

    - name: "Disable a Policy"
      dellemc.openamanage.ome_alert_policies:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        name: "Policy Name"
        enable: False
      tags: disable_alert_policy
      delegate_to: localhost

    - name: "Delete a Policy"
      dellemc.openamanage.ome_alert_policies:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        name: "Policy Name"
        state: absent
      tags: delete_alert_policy
      delegate_to: localhost
