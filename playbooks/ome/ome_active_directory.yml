---
- hosts: ome
  connection: local
  name: Dell OpenManage Ansible Active Directory service configuration.
  gather_facts: False

  collections:
    - dellemc.openmanage

  tasks:
    - name: Add Active Directory service using DNS lookup along with the test connection
      ome_active_directory:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        name: my_ad1
        domain_server:
          - domainname.com
        group_domain: domainname.com
        test_connection: yes
        domain_username: user@domainname
        domain_password: domain_password

    - name: Add Active Directory service using IP address of the domain controller with certificate validation
      ome_active_directory:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        name: my_ad2
        domain_controller_lookup: MANUAL
        domain_server:
          - 192.68.20.181
        group_domain: domainname.com
        validate_certificate: yes
        certificate_file: "/path/to/certificate/file.cer"

    - name: Modify domain controller IP address, network_timeout and group_domain
      ome_active_directory:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        name: my_ad2
        domain_controller_lookup: MANUAL
        domain_server:
          - 192.68.20.189
        group_domain: newdomain.in
        network_timeout: 150

    - name: Delete Active Directory service
      ome_active_directory:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        name: my_ad2
        state: absent

    - name: Test connection to existing Active Directory service with certificate validation
      ome_active_directory:
        hostname: "{{ hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        ca_path: "/path/to/ca_cert.pem"
        name: my_ad2
        test_connection: yes
        domain_username: user@domainname
        domain_password: domain_password
        validate_certificate: yes
        certificate_file: "/path/to/certificate/file.cer"
