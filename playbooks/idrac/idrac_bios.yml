---
- hosts: idrac
  connection: local
  name: Configure Boot Mode Setting
  gather_facts: False

  collections:
    - dellemc.openmanage

  tasks:
  - name: Configure Bios Generic Attributes
    idrac_bios:
       idrac_ip: "{{ idrac_ip }}"
       idrac_user: "{{ idrac_user }}"
       idrac_password:  "{{ idrac_password }}"
       ca_path: "/path/to/ca_cert.pem"
       attributes:
         BootMode: "Bios"
         OneTimeBootMode: "Enabled"
         BootSeqRetry: "Enabled"
    tags: 
        - bootconfig
 
  - name: Configure PXE Generic Attributes
    idrac_bios:
       idrac_ip:   "{{ idrac_ip }}"
       idrac_user: "{{ idrac_user }}"
       idrac_password:  "{{ idrac_password }}"
       ca_path: "/path/to/ca_cert.pem"
       attributes:
         PxeDev1EnDis: "Enabled"
         PxeDev1Protocol: "IPV4"
         PxeDev1VlanEnDis: "Enabled"
         PxeDev1VlanId: x
         PxeDev1Interface: "NIC.Embedded.x-x-x"
         PxeDev1VlanPriority: x
    tags: 
        - pxeconfig

  - name: Configure attributes of the BIOS at Maintenance window
    idrac_bios:
       idrac_ip:   "{{ idrac_ip }}"
       idrac_user: "{{ idrac_user }}"
       idrac_password:  "{{ idrac_password }}"
       ca_path: "/path/to/ca_cert.pem"
       apply_time: AtMaintenanceWindowStart
       maintenance_window:
         start_time: "2022-09-30T05:15:40-05:00"
         duration: 600
       attributes:
         BootMode: "Bios"
         OneTimeBootMode: "Enabled"
         BootSeqRetry: "Enabled"
    tags:
        - at_maintenance_start

  - name: Clear pending BIOS attributes
    idrac_bios:
       idrac_ip:   "{{ idrac_ip }}"
       idrac_user: "{{ idrac_user }}"
       idrac_password:  "{{ idrac_password }}"
       ca_path: "/path/to/ca_cert.pem"
       clear_pending: yes
    tags:
      - clear_pending

  - name: Reset BIOS attributes to default settings.
    idrac_bios:
      idrac_ip: "{{ idrac_ip }}"
      idrac_user: "{{ idrac_user }}"
      idrac_password: "{{ idrac_pwd }}"
      ca_path: "/path/to/ca_cert.pem"
      reset_bios: yes
    tags:
      - reset_bios

  - name: Configure Boot Sources
    idrac_bios:
       idrac_ip:   "{{ idrac_ip }}"
       idrac_user: "{{ idrac_user }}"
       idrac_password:  "{{ idrac_password }}"
       ca_path: "/path/to/ca_cert.pem"
       boot_sources:
         - Name: "NIC.Integrated.x-x-x"
           Enabled: true
           Index: 1
         - Name: "NIC.Integrated.x-x-x"
           Enabled: true
           Index: 0
    tags: 
        - boot_sources

  - name: Configure Boot Sources - Enabled
    idrac_bios:
       idrac_ip:   "{{ idrac_ip }}"
       idrac_user: "{{ idrac_user }}"
       idrac_password:  "{{ idrac_password }}"
       ca_path: "/path/to/ca_cert.pem"
       boot_sources:
         - Name: "HardDisk.List.1-1"
           Enabled: true
    tags: 
        - boot_sources_enabled

  - name: Configure Boot Sources - Index
    idrac_bios:
       idrac_ip:   "{{ idrac_ip }}"
       idrac_user: "{{ idrac_user }}"
       idrac_password:  "{{ idrac_password }}"
       ca_path: "/path/to/ca_cert.pem"
       boot_sources:
         - Name: "NIC.Integrated.x-x-x"
           Index: 1
    tags: 
        - boot_sources_index