---
- name: Converge
  hosts: all
  gather_facts: false

  tasks:
    - name: To check the behaviour of Initialization type Fast.
      ansible.builtin.import_role:
        name: redfish_storage_volume
      vars:
        hostname: "{{ lookup('env', 'IDRAC_IP') }}"
        username: "{{ lookup('env', 'IDRAC_USER') }}"
        password: "{{ lookup('env', 'IDRAC_PASSWORD') }}"
        validate_certs: false
        command: initialize
        volume_id: "{{ lookup('env', 'INVALID_VOLUME_ID') }}"
        initialize_type: "Fast"
      ignore_errors: true
      register: result

    - name: Asserting operation for initialization of type Fast.
      ansible.builtin.assert:
        that: redfish_storage_volume_out.msg == "Specified Volume Id Disk.Virtual.0:RAID.Mezzanine.1C-1-test does not exist in the System."

    - name: To check the behaviour of Initialization type Fast.
      ansible.builtin.import_role:
        name: redfish_storage_volume
      vars:
        hostname: "{{ lookup('env', 'IDRAC_IP') }}"
        username: "{{ lookup('env', 'IDRAC_USER') }}"
        password: "{{ lookup('env', 'IDRAC_PASSWORD') }}"
        validate_certs: false
        command: initialize
        volume_id: "{{ lookup('env', 'VOLUME_ID') }}"
        initialize_type: "Fast"

    - name: Asserting operation for initialization type Fast.
      ansible.builtin.assert:
        that: redfish_storage_volume_out.msg == "Successfully submitted initialize volume task."

    - name: To check the behaviour of Initialization type Slow.
      ansible.builtin.import_role:
        name: redfish_storage_volume
      vars:
        hostname: "{{ lookup('env', 'IDRAC_IP') }}"
        username: "{{ lookup('env', 'IDRAC_USER') }}"
        password: "{{ lookup('env', 'IDRAC_PASSWORD') }}"
        validate_certs: false
        command: initialize
        volume_id: "{{ lookup('env', 'VOLUME_ID') }}"
        initialize_type: "Slow"

    - name: Asserting operation for initialization type Slow.
      ansible.builtin.assert:
        that: redfish_storage_volume_out.msg == "Successfully submitted initialize volume task."
