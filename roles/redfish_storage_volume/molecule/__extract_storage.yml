---
- name: Fetching Storage controller from iDRAC
  ansible.builtin.include_tasks:
    file: ../__get_helper.yml
  vars:
    url: "Systems/System.Embedded.1/Storage?$expand=*($levels=1)"
  no_log: true

- name: Extracting Controller id
  ansible.builtin.set_fact:
    controller_id: "{{ item.Id }}"
    drive_list_odata: "{{ item.Drives }}"
    drive_list: []
  when:
    - search_in_name is defined and search_in_name in item.Name
  loop: "{{ fetched_output.json.Members }}"

- name: Extracting Drives id
  ansible.builtin.set_fact:
    drive_list: "{{ drive_list +  [item['@odata.id'] | ansible.builtin.split('/') | last] }}"
  loop: "{{ drive_list_odata }}"
  when: drive_list_odata is defined
