---
- name: "Deleting virtual disk in {{ controller_id }}"
  ansible.builtin.import_role:
    name: redfish_storage_volume
  vars:
    hostname: "{{ lookup('env', 'IDRAC_IP') }}"
    username: "{{ lookup('env', 'IDRAC_USER') }}"
    password: "{{ lookup('env', 'IDRAC_PASSWORD') }}"
    validate_certs: false
    state: absent
    volume_id: "{{ idrac_storage_controller_volume_id }}"
    reboot_server: true
    job_wait: true
    apply_time: "{{ idrac_storage_controller_apply_time }}"
  when: idrac_storage_controller_volume_id is defined

- name: Waiting for iDRAC to be in ready state
  ansible.builtin.include_tasks:
    file: ../__lc_status.yml
  when: redfish_storage_volume_out.changed
